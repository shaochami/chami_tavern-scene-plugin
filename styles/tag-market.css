/* ==================== 标签超市通用布局 ==================== */
.tsp-modal-xlarge {
    width: min(11800px, 85vw);
    height: min(1200px, 80vh);
}
.ts-layout {
    display: flex;
    height: 100%;
    gap: 15px;
    color: var(--tsp-text-primary);
    position: relative;
}

.ts-left-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    min-width: 0;
    overflow: hidden;
}

.ts-right-panel {
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    border-left: 1px solid var(--tsp-border);
    padding-left: 15px;
    flex-shrink: 0;
}

/* ==================== 搜索与导航 ==================== */
.ts-search-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 10px;
    padding: 10px;
    background: rgba(0,0,0,0.15);
    border-radius: 8px;
}

.ts-search-item label {
    display: block;
    font-size: 0.85em;
    color: var(--tsp-text-secondary);
    margin-bottom: 4px;
}

.ts-search-box {
    display: flex;
    gap: 5px;
}

.ts-search-box input {
    flex: 1;
}

/* 分类按钮 */
.ts-categories {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 5px 0;
}

.ts-category-btn {
    padding: 6px 12px;
    background: var(--tsp-bg-input);
    border: 1px solid var(--tsp-border);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    user-select: none;
}

.ts-category-btn:hover {
    background: var(--tsp-bg-secondary);
    border-color: var(--tsp-accent-primary);
}

.ts-category-btn.active {
    background: var(--tsp-accent-primary);
    color: white;
    border-color: var(--tsp-accent-primary);
}

#ts-main-cats .ts-category-btn {
    background: rgba(122, 162, 247, 0.15);
    border-color: var(--tsp-accent-primary);
    font-weight: bold;
}

#ts-sub-cats .ts-category-btn {
    background: rgba(0, 0, 0, 0.2);
    border: 1px dashed var(--tsp-border);
    font-size: 0.9em;
    color: var(--tsp-text-secondary);
}

#ts-sub-cats .ts-category-btn.active {
    background: var(--tsp-accent-secondary);
    border-style: solid;
    color: #fff;
}

/* ==================== 内容区域 (Tag卡片/图片) ==================== */
.ts-content {
    flex: 1;
    overflow-y: auto;
    padding: 5px;
    min-height: 200px;
    border: 1px solid var(--tsp-border);
    border-radius: 8px;
    background: rgba(0,0,0,0.1);
    position: relative;
}

.ts-content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
}

/* 卡片样式 */
.ts-card {
    background: var(--tsp-bg-input);
    border: 1px solid var(--tsp-border);
    border-radius: 6px;
    padding: 8px;
    cursor: pointer;
    transition: transform 0.2s;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.ts-card:hover {
    transform: translateY(-2px);
    border-color: var(--tsp-accent-primary);
}

.ts-card-img-wrap {
    width: 100%;
    aspect-ratio: 2/3;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border-radius: 4px;
}

.ts-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.ts-card-text {
    font-size: 0.85em;
    font-weight: bold;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.ts-card-sub {
    font-size: 0.75em;
    color: var(--tsp-text-muted);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* 标签选择结果列表 */
.tsp-tag-result-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.tsp-tag-result {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 999px;
    background: var(--tsp-bg-main);
    border: 1px solid var(--tsp-border);
    cursor: pointer;
    transition: all 0.15s ease;
}

.tsp-tag-result.active {
    background: var(--tsp-accent-primary);
    color: #fff;
    border-color: var(--tsp-accent-primary);
}

/* ==================== Danbooru 专用样式 ==================== */
.ts-danbooru-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    align-items: center;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.ts-danbooru-row:hover {
    background: rgba(122, 162, 247, 0.15);
}

.ts-danbooru-count {
    background: rgba(255,255,255,0.1);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 0.75em;
    color: var(--tsp-text-muted);
}

.danbooru-post-card {
    padding: 5px;
}

.ts-card-tags-area {
    height: 50px;
    overflow: hidden;
    font-size: 0.75em;
    line-height: 1.5;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    padding: 5px;
    border-top: 1px solid var(--tsp-border);
    cursor: copy;
}

.ts-card-tag-chip {
    background: var(--tsp-bg-secondary);
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
}

/* ==================== 右侧预览与加载 ==================== */
#ts-preview-area {
    flex: 1;
    background: #000;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--tsp-border);
    min-height: 200px;
    position: relative;
}

#ts-preview-area img,
#ts-preview-area video {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.ts-loading {
    font-size: 2em;
    color: var(--tsp-accent-primary);
    animation: spin 1s linear infinite;
}

@keyframes spin { 100% { transform: rotate(360deg); } }

/* ==================== 详情视图 (P-Gallery) ==================== */
.ts-detail-view {
    display: flex;
    flex-direction: column;
    gap: 15px;
    height: 100%;
}

.ts-detail-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--tsp-border);
    padding-bottom: 10px;
}

.ts-detail-content {
    flex: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.ts-detail-item {
    display: flex;
    gap: 15px;
    background: rgba(0,0,0,0.2);
    padding: 10px;
    border-radius: 8px;
}

.ts-detail-img {
    width: 200px;
    flex-shrink: 0;
}

.ts-detail-img img {
    width: 100%;
    border-radius: 4px;
    cursor: zoom-in;
}

.ts-detail-meta {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* ==================== 移动端深度适配 ==================== */
@media (max-width: 900px) {
    /* 头部强制调整 */
    .tsp-modal-header {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        align-items: center !important;
        justify-content: space-between !important;
        padding: 8px 12px !important;
        min-height: 45px !important;
    }
    /* [新增] 当处于展开模式时，隐藏右侧面板(预览/按钮区) */
    .ts-layout.mobile-expanded-mode .ts-right-panel {
        display: none !important;
    }

    /* [新增] 展开模式下，强制左侧面板占满高度 */
    .ts-layout.mobile-expanded-mode .ts-left-panel {
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    .tsp-modal-title {
        font-size: 1.1em !important;
        margin-bottom: 0 !important;
        white-space: nowrap;
    }
    #ts-close-btn {
        margin: 0 !important;
        padding: 6px 10px !important;
    }

    /* 布局调整 */
    .ts-layout { flex-direction: column; }

    .ts-right-panel {
        flex: 0 0 auto;
        width: 100%;
        height: auto;
        padding-bottom: 5px;
        order: -1; /* 放到最前 */
        padding-left: 0;
        border-left: none;
        border-bottom: 1px solid var(--tsp-border);
    }
    #ts-preview-area { height: 180px; }

    .ts-left-panel {
        flex: 1;
        overflow: hidden;
        min-height: 0;
    }

    /* 移动端内容包装器 */
    .ts-mobile-content-wrap {
        display: none;
        flex: 1;
        overflow-y: auto;
        flex-direction: column;
        order: 1;
        padding: 0 5px 60px 5px;
    }
    .ts-mobile-content-wrap.active { display: flex; }

    /* 折叠按钮 */
    .ts-mobile-toggle {
        order: 2;
        flex: 0 0 44px;
        border-top: 1px solid var(--tsp-accent-primary);
        background: var(--tsp-bg-input);
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
    }

    /* 搜索框适配 */
    .ts-search-grid {
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 5px 0;
    }
    .ts-search-item label { display: none; }
    .ts-search-box { width: 100%; gap: 8px; }
    .ts-search-box input { flex: 1; min-height: 40px; width: 0; }
    .ts-search-box button { flex: 0 0 50px; height: 40px; }

    /* 内容网格适配 */
    .ts-content-grid {
        grid-template-columns: 1fr 1fr !important;
        gap: 8px;
    }
    .ts-content-grid.ts-nai-artist-grid {
        grid-template-columns: 1fr !important; /* 强制单列 */
    }
    /* 详情页适配 */
    .ts-detail-view { height: auto !important; min-height: 100%; overflow: visible; }
    .ts-detail-content { overflow: visible !important; flex: none !important; }
    .ts-detail-item { flex-direction: column !important; }
    .ts-detail-img { width: 100% !important; }
}
#ts-content-area {
    /* 1. 设置最小高度为屏幕高度的 60%~70%，确保有足够的空间展示图片 */
    min-height: 65vh !important;

    /* 2. 禁止 Flex 压缩，防止被上方搜索框挤压 */
    flex: none !important;

    /* 3. (可选) 如果你希望整个长页面滚动而不是在这个小区域内滚动，
       取消注释下面两行，这通常在手机上体验更好 */
    height: auto !important; 
    overflow-y: visible !important; 
}
/* ==================== 标签超市自定义功能样式 ==================== */

/* 功能控制按钮（添加/删除） */
.ts-control-btn {
    width: 32px;
    padding: 0 !important;
    text-align: center;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    font-size: 14px;
}

.ts-control-btn.success {
    color: #4caf50;
    border-color: #4caf50;
    background: rgba(76, 175, 80, 0.1);
}
.ts-control-btn.success:hover {
    background: rgba(76, 175, 80, 0.2);
}

.ts-control-btn.danger {
    color: #f44336;
    border-color: #f44336;
    background: rgba(244, 67, 54, 0.1);
}
.ts-control-btn.danger:hover {
    background: rgba(244, 67, 54, 0.2);
}
.ts-control-btn.danger.active {
    background: #f44336;
    color: white;
}

/* 批量删除选中状态 - 子分类 */
.ts-category-btn.ts-delete-selected {
    background-color: #ffebee !important;
    border-color: #f44336 !important;
    color: #d32f2f !important;
    text-decoration: line-through;
    opacity: 0.8;
}

/* 标签网格内的操作卡片 (大加号/大垃圾桶) */
.ts-card-action {
    /* 移除之前的 flex 居中和最小高度 */
    min-height: auto;
    border: 1px dashed var(--tsp-border); /* 保持虚线以示区别，但边框变细 */
    display: flex;
    flex-direction: column; /* 保持上下结构 */
    gap: 4px;
    justify-content: center;
}

/* 颜色定义保持不变，但可以微调背景色使其更融合 */
.ts-card-action.success {
    color: #4caf50;
    border-color: #4caf50;
    background: rgba(76, 175, 80, 0.05);
}
.ts-card-action.success:hover {
    background: rgba(76, 175, 80, 0.15);
}

.ts-card-action.danger {
    color: #f44336;
    border-color: #f44336;
    background: rgba(244, 67, 54, 0.05);
}
.ts-card-action.danger:hover {
    background: rgba(244, 67, 54, 0.15);
}
.ts-card-action.danger.active {
    background: #f44336;
    color: white;
    border-style: solid;
}

/* 批量删除选中状态 - 标签卡片 */
.ts-card.ts-delete-selected {
    border-color: #f44336;
    background-color: rgba(244, 67, 54, 0.1);
    position: relative;
}
.ts-card.ts-delete-selected::after {
    content: "✘";
    position: absolute;
    top: 2px;
    right: 5px;
    color: #f44336;
    font-weight: bold;
    font-size: 1.2em;
}
.tsp-modal-header .tsp-btn-icon.close-modal {
    background: transparent;
    color: var(--tsp-text-primary);
    border: none;
    opacity: 0.7;
    font-size: 1.2em;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.tsp-modal-header .tsp-btn-icon.close-modal:hover {
    opacity: 1;
    background-color: var(--tsp-bg-secondary); /* 悬停时显示淡淡的主题背景色 */
}
/* ==================== 标签超市按钮特效 (柔和护眼版) ==================== */

/* --- 通用设置：字体与过渡 --- */
.ts-category-btn {
    font-weight: 600;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
    border-radius: 6px;
    backdrop-filter: blur(2px);
    /* 默认边框，防止变量未加载时消失 */
    border: 1px solid transparent;
}

/* -----------------------------------------------------------
   特殊功能按钮 (Danbooru/NAI/更衣人偶)
   变量化改造
   ----------------------------------------------------------- */
.ts-category-btn.ts-btn-special {
    /* 使用变量，提供玄色作为回退值 */
    border-color: var(--tsp-tag-special-border, rgba(255, 189, 222, 0.5)) !important;
    color: var(--tsp-tag-special-text, #ffdaeb);
    background: var(--tsp-tag-special-bg, rgba(255, 189, 222, 0.05));
    box-shadow: 0 0 10px rgba(255, 189, 222, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 悬停效果 */
.ts-category-btn.ts-btn-special:hover {
    background: var(--tsp-tag-special-hover-bg, rgba(255, 189, 222, 0.15));
    /* 悬停时边框颜色跟随主色 */
    border-color: var(--tsp-tag-special-text, #ffbdde) !important;
    color: var(--tsp-text-primary); /* 稍微提亮文字 */
    box-shadow: 0 0 15px rgba(255, 189, 222, 0.3);
    transform: translateY(-1px);
}

/* 选中状态 - 保持高亮 */
.ts-category-btn.ts-btn-special.active {
    /* 选中时使用主颜色填充，或者使用渐变 */
    background: var(--tsp-tag-special-border, #ff9ec6) !important;
    border-color: var(--tsp-tag-special-text, #ff9ec6) !important;
    box-shadow: 0 4px 15px rgba(255, 158, 198, 0.4);
    /* 选中时文字设为白色或深色，视背景而定，这里假设深色模式下用深色字 */
    color: var(--tsp-bg-main, #4a2c36);
    text-shadow: none;
}

/* -----------------------------------------------------------
   自定义按钮
   变量化改造
   ----------------------------------------------------------- */
.ts-category-btn.ts-btn-custom {
    border-color: var(--tsp-tag-custom-border, rgba(184, 164, 255, 0.5)) !important;
    color: var(--tsp-tag-custom-text, #e2daff);
    background: var(--tsp-tag-custom-bg, rgba(184, 164, 255, 0.05));
    box-shadow: 0 0 10px rgba(184, 164, 255, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 悬停效果 */
.ts-category-btn.ts-btn-custom:hover {
    background: var(--tsp-tag-custom-hover-bg, rgba(184, 164, 255, 0.15));
    border-color: var(--tsp-tag-custom-text, #b8a4ff) !important;
    color: var(--tsp-text-primary);
    box-shadow: 0 0 15px rgba(184, 164, 255, 0.3);
    transform: translateY(-1px);
}

/* 选中状态 */
.ts-category-btn.ts-btn-custom.active {
    background: var(--tsp-tag-custom-border, #9e8cfc) !important;
    border-color: var(--tsp-tag-custom-text, #9e8cfc) !important;
    box-shadow: 0 4px 15px rgba(158, 140, 252, 0.4);
    color: var(--tsp-bg-main, #312b4a);
    text-shadow: none;
}

/* 调整原来的主分类按钮间距 */
.ts-categories {
    gap: 12px !important;
    padding: 8px 5px !important;
}
/* H:\SillyTavern-1.13.4\public\scripts\extensions\third-party\chami_tavern-scene-plugin\styles\tag-market.css */

/* ... 在文件末尾追加 ... */

/* ==================== NAI 画师新布局样式 ==================== */
.nai-artist-card {
    background: var(--tsp-bg-input);
    border: 1px solid var(--tsp-border);
    border-radius: 8px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.nai-artist-card:hover {
    border-color: var(--tsp-accent-primary);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.nai-artist-card-header {
    /* [修改] 从 flex 改为 grid 布局 */
    display: grid;
    grid-template-columns: 1fr 1fr 1fr; /* [修改] 定义三列，与下方图片网格一致 */
    align-items: center;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
    padding: 6px;
    font-size: 0.8em;
    gap: 5px; /* [修改] 缩小 gap 以适应网格布局 */
}

.nai-artist-card-header span {
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 3px;
    transition: background 0.2s;
    /* [新增] 关键样式，让文本在自己的格子内居中和换行 */
    text-align: center;
    word-break: break-word; /* 强制长单词换行 */
    min-width: 0; /* 允许网格项收缩 */
}

.nai-artist-card-header span:hover {
    background: rgba(255, 255, 255, 0.1);
}

.nai-artist-image-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 5px;
    width: 100%;
    aspect-ratio: 3 / 1.5; /* 保持图片区域的比例 */
}

.nai-artist-image-grid .image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: 4px;
}

.nai-artist-image-grid img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.nai-artist-prompt {
    font-size: 0.85em;
    color: var(--tsp-text-secondary);
    background: rgba(0, 0, 0, 0.1);
    padding: 8px;
    border-radius: 4px;
    text-align: center;
    word-break: break-all;
    cursor: copy;
}
/* 1. 确保图片容器可以相对定位 Badge */
.ts-card-img-wrap {
    position: relative;
}

/* 2. Badge 元素的具体样式 */
.ts-card-model-badge {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 2; /* 确保在图片之上 */
    padding: 2px 6px;
    background-color: rgba(0, 0, 0, 0.7);
    color: #ffffff;
    font-size: 0.75em;
    font-weight: bold;
    border-bottom-right-radius: 6px; /* 右下角圆角， tạo hiệu ứng đẹp */
    text-transform: uppercase; /* 让文字大写，例如 'sd' -> 'SD' */
    pointer-events: none; /* 让鼠标可以穿透 Badge 点击下方的图片 */
}
@media (min-width: 901px) {
    .ts-mobile-toggle { display: none; }
    .ts-mobile-content-wrap { display: flex !important; flex-direction: column; gap: 10px; height: 100%; }
}
